# MatchGen Backend - Deployment Guide

## üöÄ Deployment Overview

This guide covers the complete deployment process for the MatchGen Backend API on Railway, including environment setup, database configuration, and production deployment.

---

## üìã Prerequisites

### Required Accounts
- **Railway Account**: [railway.app](https://railway.app)
- **GitHub Account**: For code repository
- **Cloudinary Account**: For file uploads (optional)
- **Stripe Account**: For payments (optional)

### Required Tools
- **Git**: Version control
- **Railway CLI**: `npm install -g @railway/cli`
- **Python 3.8+**: For local development

---

## üèóÔ∏è Current Deployment Architecture

### Production Environment
- **Platform**: Railway
- **Service Name**: `matchgen-backend`
- **Environment**: Production
- **Database**: PostgreSQL (Railway managed)
- **Domain**: `matchgen-backend-production.up.railway.app`

### Frontend Integration
- **Frontend Platform**: Vercel
- **Frontend Domain**: `matchgen-frontend.vercel.app`
- **CORS Configuration**: Configured for frontend access

---

## üîß Railway Deployment Setup

### Step 1: Connect to Railway

```bash
# Login to Railway
npx @railway/cli login

# Link to your project
npx @railway/cli link

# Select your project and environment
# Project: considerate-wisdom
# Environment: production
# Service: matchgen-backend
```

### Step 2: Configure Environment Variables

Set the following environment variables in Railway dashboard:

#### Required Variables
```env
SECRET_KEY=django-insecure-your-secret-key-here
DEBUG=False
DATABASE_URL=postgresql://... (auto-generated by Railway)
ALLOWED_HOSTS=matchgen-backend-production.up.railway.app,localhost,127.0.0.1
CSRF_TRUSTED_ORIGINS=https://matchgen-backend-production.up.railway.app,https://matchgen-frontend.vercel.app
CORS_ALLOWED_ORIGINS=https://matchgen-frontend.vercel.app,http://localhost:3000
```

#### Optional Variables
```env
# Cloudinary Configuration
CLOUDINARY_CLOUD_NAME=your-cloud-name
CLOUDINARY_API_KEY=your-api-key
CLOUDINARY_API_SECRET=your-api-secret

# Stripe Configuration
STRIPE_SECRET_KEY=sk_test_...
STRIPE_PUBLISHABLE_KEY=pk_test_...
STRIPE_WEBHOOK_SECRET=whsec_...

# Email Configuration
EMAIL_HOST_USER=your-email@gmail.com
EMAIL_HOST_PASSWORD=your-app-password
```

### Step 3: Deploy Application

```bash
# Push code to trigger deployment
git add .
git commit -m "Deploy to Railway"
git push origin main

# Railway will automatically deploy on push to main branch
```

### Step 4: Run Database Migrations

```bash
# Run migrations
npx @railway/cli run python manage.py migrate --noinput

# Check migration status
npx @railway/cli run python manage.py showmigrations

# Create superuser (if needed)
npx @railway/cli run python manage.py createsuperuser
```

---

## üìä Deployment Configuration Files

### Procfile
```procfile
web: python manage.py migrate && python manage.py runserver 0.0.0.0:8000
```

### requirements.txt
Key dependencies for production:
```
Django==5.1.7
djangorestframework==3.15.2
djangorestframework_simplejwt==5.5.0
psycopg2-binary==2.9.10
gunicorn==23.0.0
whitenoise==6.9.0
cloudinary==1.44.0
stripe==12.5.0
```

### Railway Configuration
- **Build Command**: Automatic (detects Python)
- **Start Command**: From Procfile
- **Health Check**: `/api/health/` endpoint

---

## üîç Deployment Verification

### Health Check
```bash
# Check if API is running
curl https://matchgen-backend-production.up.railway.app/api/health/

# Expected response:
{
  "status": "healthy",
  "message": "MatchGen API is working",
  "timestamp": "2025-09-02T19:30:00Z",
  "database": "connected",
  "authentication": "jwt_enabled"
}
```

### Database Connection
```bash
# Check database connectivity
npx @railway/cli run python manage.py check --database default
```

### Migration Status
```bash
# Verify all migrations are applied
npx @railway/cli run python manage.py showmigrations
```

---

## üõ†Ô∏è Railway CLI Commands

### Service Management
```bash
# View service status
npx @railway/cli status

# View logs
npx @railway/cli logs

# View logs with follow
npx @railway/cli logs --follow

# Connect to service shell
npx @railway/cli shell
```

### Database Operations
```bash
# Run Django commands
npx @railway/cli run python manage.py migrate
npx @railway/cli run python manage.py collectstatic
npx @railway/cli run python manage.py createsuperuser

# Access Django shell
npx @railway/cli run python manage.py shell
```

### Environment Variables
```bash
# List environment variables
npx @railway/cli variables

# Set environment variable
npx @railway/cli variables set SECRET_KEY=your-new-secret-key

# Get environment variable
npx @railway/cli variables get SECRET_KEY
```

---

## üîÑ Continuous Deployment

### GitHub Integration
1. **Repository**: Connected to GitHub
2. **Branch**: `main` branch triggers deployment
3. **Auto-deploy**: Enabled for main branch
4. **Build**: Automatic on push

### Deployment Process
1. Code pushed to `main` branch
2. Railway detects changes
3. Builds application
4. Runs migrations automatically
5. Deploys to production
6. Health checks performed

### Rollback Process
```bash
# View deployment history
npx @railway/cli deployments

# Rollback to previous deployment
npx @railway/cli rollback <deployment-id>
```

---

## üêõ Troubleshooting Deployment Issues

### Common Issues

#### 1. Build Failures
```bash
# Check build logs
npx @railway/cli logs --build

# Common causes:
# - Missing dependencies in requirements.txt
# - Syntax errors in code
# - Environment variable issues
```

#### 2. Migration Errors
```bash
# Check migration status
npx @railway/cli run python manage.py showmigrations

# Reset migrations if needed
npx @railway/cli run python manage.py migrate --fake users zero
npx @railway/cli run python manage.py migrate --fake content zero
npx @railway/cli run python manage.py migrate --fake graphicpack zero
npx @railway/cli run python manage.py migrate
```

#### 3. Environment Variable Issues
```bash
# Check environment variables
npx @railway/cli variables

# Verify in Django shell
npx @railway/cli run python manage.py shell
>>> import os
>>> print(os.getenv('SECRET_KEY'))
>>> print(os.getenv('DATABASE_URL'))
```

#### 4. CORS Issues
```bash
# Check CORS configuration
npx @railway/cli run python manage.py shell
>>> from django.conf import settings
>>> print(settings.CORS_ALLOWED_ORIGINS)
```

### Debug Commands
```bash
# Check Django configuration
npx @railway/cli run python manage.py check --deploy

# Validate models
npx @railway/cli run python manage.py validate

# Check for broken links
npx @railway/cli run python manage.py check --database default
```

---

## üìà Monitoring & Logs

### Railway Dashboard
- **Metrics**: CPU, Memory, Network usage
- **Logs**: Real-time application logs
- **Deployments**: Deployment history and status
- **Variables**: Environment variable management

### Application Logs
```bash
# View recent logs
npx @railway/cli logs

# Follow logs in real-time
npx @railway/cli logs --follow

# Filter logs by level
npx @railway/cli logs --level error
```

### Health Monitoring
- **Endpoint**: `/api/health/`
- **Frequency**: Every 30 seconds
- **Timeout**: 30 seconds
- **Retries**: 3 attempts

---

## üîí Security Configuration

### Production Security
- **DEBUG**: Set to `False`
- **SECRET_KEY**: Strong, unique key
- **ALLOWED_HOSTS**: Restricted to production domain
- **CSRF_TRUSTED_ORIGINS**: Configured for frontend
- **CORS**: Restricted to frontend domain

### SSL/TLS
- **Certificate**: Automatic SSL certificate (Railway)
- **HTTPS**: Enforced for all connections
- **HSTS**: Enabled for security headers

### Database Security
- **Connection**: SSL encrypted
- **Credentials**: Managed by Railway
- **Access**: Restricted to application

---

## üîÑ Backup & Recovery

### Database Backups
```bash
# Railway automatically handles PostgreSQL backups
# Backup frequency: Daily
# Retention: 7 days
# Manual backup available in Railway dashboard
```

### Code Backup
- **Repository**: GitHub (primary backup)
- **Branch Protection**: Enabled for main branch
- **Deployment History**: Available in Railway dashboard

### Recovery Process
1. **Code Recovery**: Clone from GitHub
2. **Database Recovery**: Restore from Railway backup
3. **Environment Recovery**: Recreate from documentation
4. **Deployment**: Redeploy to Railway

---

## üìä Performance Optimization

### Railway Optimizations
- **Auto-scaling**: Based on traffic
- **Resource allocation**: Optimized for Django
- **CDN**: Static files served via Railway CDN

### Application Optimizations
- **Database**: Connection pooling
- **Caching**: Django cache framework
- **Static files**: Whitenoise for serving
- **Images**: Cloudinary CDN

### Monitoring
- **Response times**: Tracked in Railway dashboard
- **Error rates**: Monitored via logs
- **Resource usage**: CPU/Memory monitoring

---

## üîß Environment-Specific Configurations

### Development Environment
```env
DEBUG=True
ALLOWED_HOSTS=localhost,127.0.0.1
CORS_ALLOWED_ORIGINS=http://localhost:3000
DATABASE_URL=sqlite:///db.sqlite3
```

### Staging Environment
```env
DEBUG=False
ALLOWED_HOSTS=staging-matchgen-backend.up.railway.app
CORS_ALLOWED_ORIGINS=https://staging-matchgen-frontend.vercel.app
DATABASE_URL=postgresql://... (staging database)
```

### Production Environment
```env
DEBUG=False
ALLOWED_HOSTS=matchgen-backend-production.up.railway.app
CORS_ALLOWED_ORIGINS=https://matchgen-frontend.vercel.app
DATABASE_URL=postgresql://... (production database)
```

---

## üöÄ Scaling Considerations

### Current Limits
- **Railway Free Tier**: 500 hours/month
- **Database**: 1GB storage
- **Bandwidth**: 100GB/month

### Scaling Options
- **Upgrade Plan**: Railway Pro for more resources
- **Load Balancing**: Multiple instances
- **Database**: Larger PostgreSQL instance
- **CDN**: Enhanced static file delivery

### Performance Monitoring
- **Response Times**: Target < 200ms
- **Error Rate**: Target < 1%
- **Uptime**: Target 99.9%

---

## üìû Support & Maintenance

### Railway Support
- **Documentation**: [docs.railway.app](https://docs.railway.app)
- **Community**: Railway Discord
- **Support**: Railway support tickets

### Application Support
- **Logs**: Available in Railway dashboard
- **Metrics**: Performance monitoring
- **Alerts**: Configured for critical issues

### Maintenance Schedule
- **Security Updates**: Monthly
- **Dependency Updates**: Quarterly
- **Database Maintenance**: Weekly backups
- **Performance Review**: Monthly

---

## üìã Deployment Checklist

### Pre-Deployment
- [ ] Code reviewed and tested
- [ ] Environment variables configured
- [ ] Database migrations ready
- [ ] Dependencies updated
- [ ] Security settings verified

### Deployment
- [ ] Code pushed to main branch
- [ ] Railway deployment successful
- [ ] Migrations applied
- [ ] Health checks passing
- [ ] Frontend integration tested

### Post-Deployment
- [ ] Application accessible
- [ ] API endpoints responding
- [ ] Database connectivity verified
- [ ] Logs monitored for errors
- [ ] Performance metrics checked

---

*Last Updated: September 2025*
*Version: 1.0.0*
